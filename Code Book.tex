\documentclass[a4paper]{article}
\usepackage{graphicx}
\usepackage{verbatim}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{placeins}
\usepackage[english]{babel}
\usepackage{parskip}


\title{Code book}
\author{Aaron Nova, Till Nils BÃ¶hringer, \\ 
Moises De Jesus Maldonado Alonso, Florian Hellwig}
\date{23.05.2024}

\newcommand\Plotwidth{0.8}
\newcommand\Bilderwidth{0.8}

\begin{document}

\maketitle

\section{Datasets}

\subsection{Significant earthquake database (CSV): 1193 entries from 2000-2020}
\begin{itemize}
\item \textbf{Source:} National Centers for
Environmental Information
\item \textbf{Information about the dataset:} Contains data about time point, location, magnitude, financial costs, and human losses of earthquakes that happened in the years 2000-2020
\item \textbf{Date of retrieval:} 18.04.2024
\item \textbf{Data Source:} https://www.ngdc.noaa.gov/hazel/view/hazards/earthquake/event-data?maxYear=2020\&minYear=1999
\end{itemize}

\begin{comment}

\subsection{WHICH ONE WILL WE USE? Population density of the world, years 2000, 2005, 2010, 2015, 2020 (GeoTIFF (.tif) and ASCII (.asc))}
\begin{itemize}
\item \textbf{Source:} [Insert Dataset Name]
\item \textbf{Information of the dataset:} [Insert information]
\item \textbf{Date of retrieval:} 
\item \textbf{Data Source:} https://sedac.ciesin.columbia.edu/data/set/gpw-v4-population-density-rev11/data-download
\end{itemize}

\subsection{WHICH ONE WILL WE USE? High-Resolution Population Density Maps around the year 2020 (GeoTIFF sometimes CSV)}
\begin{itemize}
\item \textbf{Source:} [Insert Dataset Name]
\item \textbf{Information of the dataset:} [Insert information]
\item \textbf{Date of retrieval:} [Insert Date]
\item \textbf{Data Source:} DOES NOT WORK: https://data.humdata.org/organization/meta?q=population%20density&sort=score%20desc%2C%2 
\end{itemize}

\end{comment}

\subsection{Average national income from 2000-2020 (CSV)}
\begin{itemize}
\item \textbf{Source:} World Inequality Database
\item \textbf{Information of the dataset:} Contains the average national income and the average income of the poorer half of the population for different countries for every year between 2000 and 2020
\item \textbf{Date of retrieval:} 23.04.2024
\item \textbf{Data Source:} https://wid.world/data/
\end{itemize}

\subsection{Population Counts / Unconstrained global mosaics 2000-2020 ( 1 km resolution )}
\begin{itemize}
\item \textbf{Source:} WorldPop Hub
\item \textbf{Information of the dataset:} Contains the population counts of the different parts of the world with a resolution of 1 $\text{km}^2$
\item \textbf{Date of retrieval:} 04.05.2024
\item \textbf{Data Source:} https://hub.worldpop.org/geodata/listing?id=64
\end{itemize}

\section{Variables in the Master Data frame}

\subsection{Year}
\begin{itemize}
    \item \textbf{Description:} Year the earthquake happened
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} 2000 - 2020, integers
    \item \textbf{Missing Values:} No values were missing
    \item \textbf{Notes:} -
\end{itemize}

\begin{comment}
\subsection{Mo}
\begin{itemize}
    \item \textbf{Description:} Month the earthquake happened
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} 1 - 12, integers
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Dy}
\begin{itemize}
    \item \textbf{Description:} Day the earthquake happened 
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} 1 - 31, integers
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Hr}
\begin{itemize}
    \item \textbf{Description:} Hour the earthquake happened  
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} 0 - 23, integers (but displayed as floating point numbers)
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} -
\end{itemize}

\end{comment}

\begin{comment}

\subsection{Mn}
\begin{itemize}
    \item \textbf{Description:} Minute the earthquake happened  
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} 0 - 59, integers (but displayed as floating point numbers)
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Sec}
\begin{itemize}
    \item \textbf{Description:} Second the earthquake happened  
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} 0.0 - 59.9, rounded to the nearest tenth
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Tsu}
\begin{itemize}
    \item \textbf{Description:} ??? 
    \item \textbf{Type:} ???
    \item \textbf{Units:} ???
    \item \textbf{Range/Values:} ???
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} ???
\end{itemize}

\subsection{Vol}
\begin{itemize}
    \item \textbf{Description:} ??? 
    \item \textbf{Type:} ???
    \item \textbf{Units:} ???
    \item \textbf{Range/Values:} ???
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} ???
\end{itemize}

\end{comment}

\subsection{Country}
\begin{itemize}
    \item \textbf{Description:} Country where the earthquake happened
    \item \textbf{Type:} Categorical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} Countries worldwide
    \item \textbf{Missing Values:} No values were missing
    \item \textbf{Notes:} -
\end{itemize}

\begin{comment}

\subsection{Location Name}
\begin{itemize}
    \item \textbf{Description:} Location where the earthquake happened (with country and location name)
    \item \textbf{Type:} String ???
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} -
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} -
\end{itemize}

\end{comment}

\begin{comment}

\subsection{Region}
\begin{itemize}
    \item \textbf{Description:} Region where the earthquake happened
    \item \textbf{Type:} Categorical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} Regions worldwide
    \item \textbf{Missing Values:} ???
    \item \textbf{Notes:} -
\end{itemize}

\end{comment}

\subsection{Latitude}
\begin{itemize}
    \item \textbf{Description:} Latitude of the location where the earthquake happened
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} Degrees
    \item \textbf{Range/Values:} -90 - 90, rounded to the nearest thousandths
    \item \textbf{Missing Values:} No values were missing
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Longitude}
\begin{itemize}
    \item \textbf{Description:} Longitude of the location where the earthquake happened
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} Degrees
    \item \textbf{Range/Values:} -180 - 180, rounded to the nearest thousandths
    \item \textbf{Missing Values:} No values were missing
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Focal Depth (km)}
\begin{itemize}
    \item \textbf{Description:} Focal depth of the earthquake
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} Kilometers
    \item \textbf{Range/Values:} Positive integers
    \item \textbf{Missing Values:} No values were missing
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Mag}
\begin{itemize}
    \item \textbf{Description:} Magnitude of the earthquake on the Richter scale
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} Normally between 1 and 10
    \item \textbf{Missing Values:} Tuples with a missing magnitude value were dropped completely
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Total Deaths}
\begin{itemize}
    \item \textbf{Description:} Number of deaths because of the earthquake
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} People
    \item \textbf{Range/Values:} Non negative integers
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if there were no deaths, the field was left blank
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Total Death Description}
\begin{itemize}
    \item \textbf{Description:} Classification of the strength of the earthquake based on the number of deaths
    \item \textbf{Type:} Categorical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} $\{0,1,2,3,4 \}$
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if there were no deaths, the field was left blank
    \item \textbf{Notes:} 0: No deaths, 1: 1-50 deaths, 2: 51-100 deaths, 3: 101-1000 deaths, 4: more than 1000 deaths
\end{itemize}

\subsection{Total Injuries}
\begin{itemize}
    \item \textbf{Description:} Number of people injured because of the earthquake
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} People
    \item \textbf{Range/Values:} Non negative integers
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if no people were injured, the field was left blank
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Total Injuries Description}
\begin{itemize}
    \item \textbf{Description:} Classification of the strength of the earthquake based on the number of people injured
    \item \textbf{Type:} Categorical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} $\{0,1,2,3,4 \}$
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if no people were injured, the field was left blank
    \item \textbf{Notes:} 0: No people injured, 1: 1-50 people injured, 2: 51-100 people injured, 3: 101-1000 people injured, 4: more than 1000 people injured
\end{itemize}

\subsection{Total Damage (\$Mil)}
\begin{itemize}
    \item \textbf{Description:} Total financial damage the earthquake has caused
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} Millions US-Dollars
    \item \textbf{Range/Values:} Non negative values 
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if there was no financial damage, the field was left blank
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Total Damage Description}
\begin{itemize}
    \item \textbf{Description:} Classification of the strength of the earthquake based on the total financial damage
    \item \textbf{Type:} Categorical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} $\{0,1,2,3,4 \}$
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if there was no financial damage, the field was left blank
    \item \textbf{Notes:} 0: No costs, 1: 0-1 million US-Dollars, 2: 1-5 million US-Dollars, 3: 5-30 million US-Dollars, 4: more than 30 million US-Dollars
\end{itemize}

\subsection{Total Houses Destroyed}
\begin{itemize}
    \item \textbf{Description:} Number of houses destroyed because of the earthquake
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} Houses
    \item \textbf{Range/Values:} Non negative integers
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if no houses were destroyed, the field was left blank
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Total Houses Destroyed Description}
\begin{itemize}
    \item \textbf{Description:} Classification of the strength of the earthquake based on the number of houses destroyed
    \item \textbf{Type:} Categorical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} $\{0,1,2,3,4 \}$
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if no houses were destroyed, the field was left blank
    \item \textbf{Notes:} 0: No houses destroyed, 1: 1-50 houses destroyed, 2: 51-100 houses destroyed, 3: 101-1000 houses destroyed, 4: more than 1000 houses destroyed
\end{itemize}

\subsection{Total Houses Damaged}
\begin{itemize}
    \item \textbf{Description:} Number of houses damaged because of the earthquake
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} Houses
    \item \textbf{Range/Values:} Non negative integers
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if no houses were damaged, the field was left blank
    \item \textbf{Notes:} -
\end{itemize}

\subsection{Total Houses Damaged Description}
\begin{itemize}
    \item \textbf{Description:} Classification of the strength of the earthquake based on the number of houses damaged
    \item \textbf{Type:} Categorical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} $\{0,1,2,3,4 \}$
    \item \textbf{Missing Values:} Set to 0, based on the raw data, it's assumed that if no houses were damaged, the field was left blank
    \item \textbf{Notes:} 0: No houses damaged, 1: 1-50 houses damaged, 2: 51-100 houses damaged, 3: 101-1000 houses damaged, 4: more than 1000 houses damaged
\end{itemize}

\subsection{Average Income}
\begin{itemize}
    \item \textbf{Description:} Average yearly income of the population of the country where the earthquake happened
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} US-Dollars
    \item \textbf{Range/Values:} Positive values, rounded to the next ten thousandth
    \item \textbf{Missing Values:} No values were missing
    \item \textbf{Notes:} -
\end{itemize}

\subsection{p0p50\_share}
\begin{itemize}
    \item \textbf{Description:} Percentage of the total income of the poorer half of the population compared to the total income of the whole population
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} Percentage
    \item \textbf{Range/Values:} Between 0 and 1, rounded to the next ten thousandth
    \item \textbf{Missing Values:} Tuples with a missing p0p50\_share value were dropped completely
    \item \textbf{Notes:} -
\end{itemize}

\subsection{pop\_total}
\begin{itemize}
    \item \textbf{Description:} Total population in the preparation radius of the earthquake
    \item \textbf{Type:} Numerical
    \item \textbf{Units:} -
    \item \textbf{Range/Values:} Positive floats, rounded to nearest integer
    \item \textbf{Missing Values:} No values were missing
    \item \textbf{Notes:} Calculated based on the population density data: First, the preparation radius was calculated with the magnitude, and then the number of people within this radius was summed up. Reference: \lstinline{"pop_regional.ipynb"}; 
    Only in the file \lstinline{"master_df_reduced.ipynb"}
\end{itemize}


\begin{comment}

\end{comment}

The columns Mo, Dy, Hr, Mn, Sec, Tsu, Vol, Location Name, MMI Int, Deaths, Death Description, Missing, Missing Description, Injuries, Injuries Description, Damage (\$Mil), Damage Description, Houses Destroyed, Houses Destroyed Description, Houses Damaged, Houses Damaged Description, Total Missing, Total Missing Description, Total Houses Damaged Description.1, Region, Population density national were not listed here as they were not used and dropped from the beginning (e.g. Tsu), or they were created but later dropped because of a better solution (e.g. Population density national).

\begin{comment}
\section{Summary choices}
\end{comment}

\section{Study design}

\subsection{Regional population data}

The total population that lives in the area of the earthquake, will probably have an impact on the severity of the earthquake. Therefore, we wanted to include this in our data. The data came in the form of GeoTIFF's, these are TIFF graphics in which every pixel luminosity is the corresponding value and there is also the geographical data in the metadata of the file. The values are the population density and the resolution is $1 km^2$. Which means the Files are huge, over $1 GB$. From 2000 to 2020, this means the hole dataset is over $25 GB$. So the data has to be pulled out selectively without loading the hole data.

It's also the question from which area around the earthquake the population should be calculated. There is a preparation radius that is a basis in what radius preparation should be made, based on the magnitude of the earthquake\footnote{Source: The Possibility of Earthquake Forecasting, Sergey Pulinets and Dimitar Ouzounov, 2018, ISBN: 978-0-7503-1249-3}.

\begin{table}[h]
    \centering
    \caption{The radius of the preparation zone, based on the magnitude.}
    \label{tab:preperation_radius}
    \begin{tabular}{|r|r|}
    \hline
    Magnitude & Earthquake preparation zone radius (km) \\ \hline
    3         & 19.5                                    \\ \hline
    4         & 52.5                                    \\ \hline
    5         & 141                                     \\ \hline
    6         & 380                                     \\ \hline
    7         & 1022                                    \\ \hline
    8         & 2754                                    \\ \hline
    9         & 7413                                    \\ \hline
    \end{tabular}
    \end{table}

The table \ref{tab:preperation_radius} got linear interpolated to all earthquakes in the data. Based on this radius, the location of the earthquake and the year, just the local data from the GeoTIFF got loaded and the out of this the total population in the area got calculated. All this is in the file \lstinline{"pop_regional.ipynb"}.

\subsection{Dimension reduction}

The data is sparse, to combat this, the dimension of the data gets reduced. For the reduction, the description columns were chosen. These columns are already binned with adequate ranges, which speeds thing up. For the dimension reduction, PCA was considered. With the PCA, it's not clear how the data columns are calculated together, and it's also not clear that a lower value after the PCA is necessarily a low value for all included columns. Therefore, a second choice was made to sum all columns and then map the values between 0 and 1. Because the columns are all already all between 0 and 4 there don't need to be normalized.

\begin{figure}[h]
    \centering
    \includegraphics[width=\Plotwidth\textwidth]{Plots/PCA_SUM.pdf}
    \caption{Comparison between PCA and SUM over the reduced columns.}
    \label{fig:PCA_SUM}
\end{figure}

In figure \ref{fig:PCA_SUM} can be seen, the Histograms between PCA and SUM are fairly similar. This is all in the file \lstinline{"dimension_reduction.ipynb"}. The dataframe that came out of this is \lstinline{"master_df_reduced.csv"}. This is also the one most models are based on.

\FloatBarrier
\section{Software (incl. versions) used}

\begin{itemize}
    \item Python: 3.9.13
    \item Overleaf (online version, current) (for the code book)
\end{itemize}

\end{document}
